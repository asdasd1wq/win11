name: Setup macOS Environment with RDP

on:
  workflow_dispatch:
    inputs:
      portmap_config_url:
        description: 'Please paste the URL of the webpage or file you want to download:'
        required: true

jobs:
  setup:
    runs-on: macos-12

    steps:
    - name: Install Homebrew
      run: |
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        
    - name: Install OpenVPN
      run: brew install openvpn

    - name: Install FreeRDP
      run: brew install freerdp

    - name: Download Portmap Configuration
      run: |
        inputUrl="${{ github.event.inputs.portmap_config_url }}"
        curl -L -o "portmap.ovpn" "$inputUrl"

    - name: Output User Credentials
      run: |
        echo "User Name: $(whoami)"
        echo "Password: P@ssw0rd!"
        echo "RDP is set up. You can use the FreeRDP client to connect."

    - name: Start FreeRDP
      run: |
        xfreerdp /v:localhost /u:$(whoami) /p:P@ssw0rd! /cert:ignore

    - name: Configure OpenVPN
      run: |
        sudo openvpn --config portmap.ovpn
